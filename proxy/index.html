<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="apple-touch-icon" sizes="180x180" href="image/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="image/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="image/favicon-16x16.png">

  <link rel="stylesheet" href="css/bootstrap-4.0.0.css">
  <link rel="stylesheet" href="css/maplibre-gl-3.6/maplibre-gl.css">
  <style>
      html,
      body {
          padding: 0;
          margin: 0;
      }

      #map-container {
          width: 100vw;
          height: 100vh;
      }
      #map {
          position: relative;
          width: 100%;
          height: 100%;
      }

      .search-container {
          position: absolute;
          z-index: 100;
          padding: .5rem;
          padding-right: 3rem;
          background: transparent;
          width: 400px;
      }
      .search-container input[type=search] {
          padding: 6px;
          font-family: sans-serif;
          width: 14rem;
      }
      .search-container .input-group-append {
          background-color: white;
      }
      #search-results {
          display: none;
          background-color: white;
          padding: .3rem 0;
          max-height: 300px;
          overflow-y: auto;
          border-bottom-left-radius: 2px;
          border-bottom-right-radius: 2px;
          box-shadow: 0 0 0 2px rgba(0,0,0,.1);
      }
      #search-results .result {
          border-bottom: 1px solid #eee;
          padding: 0 .5rem;
          cursor: pointer;
      }
      #search-results .result:nth-child(2n) {
          background: #f8f8f8;
      }
      #search-results .result:hover, #search-results .result:nth-child(2n):hover {
          background: #eee;
      }
      .search-container .search-icon {
          position: absolute;
          top: 12px;
          right: 14px;
          z-index: 30;
          cursor: pointer;
      }
      .search-container #cancel-icon {
          display: none;
      }

      .maplibregl-ctrl-style {
          font-size: 1rem;
          padding: .5rem;
      }
      .maplibregl-ctrl-style .form-check.form-check-inline:last-child {
          margin-right: 0;
      }
  </style>
  <title>OpenRailwayMap</title>
</head>

<body>
<div id="map-container">
  <div class="search-container">
    <div class="input-group">
      <input type="search" id="search" class="form-control" placeholder="Search..." autocomplete="no">
      <svg role="presentation" onclick="searchFor(search.value)" id="search-icon" class='search-icon' viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="#57ae00" stroke-linecap="round" stroke-linejoin="round" stroke-width="4">
        <circle cx="14" cy="14" r="12" />
        <path d="M23 23 L30 30" />
      </svg>
      <svg role="presentation" onclick="hideSearchResults()" id="cancel-icon" class="search-icon" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="#ae0000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M4 4 L28 28" />
        <path d="M4 28 L28 4" />
      </svg>
    </div>
    <div id="search-results"></div>
  </div>
  <div id="map"></div>
</div>

<script src="js/maplibre-gl-3.6/maplibre-gl.js"></script>
<script>
  const search = document.getElementById('search');
  const searchResults = document.getElementById('search-results');
  const searchIcon = document.getElementById('search-icon');
  const cancelIcon = document.getElementById('cancel-icon');
  function searchFor(term) {
    if (!term || term.length < 3) {
      hideSearchResults();
    } else {
      // or ref=...
      fetch(`https://api.openrailwaymap.org/v2/facility?name=${term}`)
        .then(result => result.json())
        .then(result => {
          console.info('result', result, result.body)
          showSearchResults(result)
        })
        .catch(error => {
          hideSearchResults();
          console.error(error);
        });
    }
  }
  function showSearchResults(results) {
    let content = '';
    if (results.length === 0) {
      content += `<div class="result" onclick="hideSearchResults()"><i>No results</i></div>`
    } else {
      results.forEach(result => {
        content += `<div class="result" onclick="hideSearchResults(); map.panTo([${result.latitude}, ${result.longitude}])">${result.name}</div>`
      })
    }
    searchResults.innerHTML = content;
    searchResults.style.display = 'block';
    cancelIcon.style.display = 'block';
    searchIcon.style.display = 'none';
  }
  function hideSearchResults() {
    searchResults.style.display = 'none';
    cancelIcon.style.display = 'none';
    searchIcon.style.display = 'block';
  }

  search.addEventListener('keydown', event => {
    if (event.key === 'Enter') {
      searchFor(event.target.value);
    }
  });
</script>
<script>
  function createDomElement(tagName, className, container) {
    const el = window.document.createElement(tagName);
    if (className !== undefined) el.className = className;
    if (container) container.appendChild(el);
    return el;
  }

  function removeDomElement(node) {
    if (node.parentNode) {
      node.parentNode.removeChild(node);
    }
  }
</script>
<script>
  const knownStyles = {
    standard: 'Infrastructure',
    speed: 'Speed',
    signals: 'Train protection',
    electrification: 'Electrification',
    gauge: 'Gauge',
  };
  function hashToObject(hash) {
    if (!hash) {
      return {};
    } else {
      const strippedHash = hash.replace('#', '');
      const hashEntries = strippedHash
        .split('&')
        .map(item => item.split('=', 2))
      return Object.fromEntries(hashEntries);
    }
  }
  function determineStyleFromHash(hash) {
    const defaultStyle = Object.keys(knownStyles)[0];
    const hashObject = hashToObject(hash);
    if (hashObject.style && hashObject.style in knownStyles) {
      return hashObject.style
    } else {
      return defaultStyle;
    }
  }
  function putStyleInHash(hash, style) {
    const hashObject = hashToObject(hash);
    hashObject.style = style;
    return `#${Object.entries(hashObject).map(([key, value]) => `${key}=${value}`).join('&')}`;
  }
  const selectedStyle = determineStyleFromHash(window.location.hash)

  const railwayLineWidth = ['step', ['zoom'],
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
      ], 1.5,
      0,
    ],
    5,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
      ], 2.5,
      0,
    ],
    7,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
        ]
      ], 1.5,
      0,
    ],
    8,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
        ]
      ], 3.5,
      ['all',
        ['==', ['get', 'railway'], 'construction'],
        ['==', ['get', 'feature'], 'rail'],
        ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
        ['==', ['get', 'service'], null],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    9,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
        ]
      ],
      ['case',
        ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3.5,
      ],
      ['all',
        ['==', ['get', 'feature'], 'narrow_gauge'],
        ['==', ['get', 'service'], null],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'railway'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'feature'], 'construction'],
          ['any',
            ['==', ['get', 'railway'], 'subway'],
            ['==', ['get', 'railway'], 'light_rail'],
            ['==', ['get', 'railway'], 'monorail'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['any',
            ['==', ['get', 'feature'], 'subway'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'monorail'],
          ],
          ['==', ['get', 'service'], null],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    10,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['==', ['get', 'usage'], 'industrial'],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
        ]
      ],
      ['case',
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
        ], 2,
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['!=', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
        ], 1.5,
        3.5,
      ],
      ['all',
        ['==', ['get', 'feature'], 'narrow_gauge'],
        ['any',
          ['==', ['get', 'service'], null],
          ['==', ['get', 'service'], 'spur'],
          ['==', ['get', 'service'], 'siding'],
          ['==', ['get', 'service'], 'crossover'],
        ],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'feature'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'feature'], 'subway'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'tram'],
            ['==', ['get', 'feature'], 'monorail'],
            ['==', ['get', 'feature'], 'miniature'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['any',
            ['==', ['get', 'feature'], 'subway'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'tram'],
            ['==', ['get', 'feature'], 'monorail'],
            ['==', ['get', 'feature'], 'miniature'],
          ],
          ['==', ['get', 'service'], null],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    11,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['==', ['get', 'usage'], 'industrial'],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
        ]
      ],
      ['case',
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
        ], 2,
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['!=', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
        ], 1.5,
        3.5,
      ],
      ['all',
        ['==', ['get', 'feature'], 'narrow_gauge'],
        ['any',
          ['==', ['get', 'service'], null],
          ['==', ['get', 'service'], 'spur'],
          ['==', ['get', 'service'], 'siding'],
          ['==', ['get', 'service'], 'crossover'],
          ['==', ['get', 'service'], 'yard'],
        ],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'feature'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'feature'], 'subway'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'tram'],
            ['==', ['get', 'feature'], 'monorail'],
            ['==', ['get', 'feature'], 'miniature'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['any',
            ['==', ['get', 'feature'], 'subway'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'tram'],
            ['==', ['get', 'feature'], 'monorail'],
            ['==', ['get', 'feature'], 'miniature'],
          ],
          ['==', ['get', 'service'], null],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
    12,
    ['case',
      ['all',
        ['==', ['get', 'feature'], 'rail'],
        ['any',
          ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], 'branch'], ['==', ['get', 'service'], null]],
          ['==', ['get', 'usage'], 'industrial'],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], null]],
        ]
      ],
      ['case',
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], null]],
        ], 2,
        ['any',
          ['all', ['==', ['get', 'usage'], 'industrial'], ['!=', ['get', 'service'], null]],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']],
          ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']],
        ], 1.5,
        3.5,
      ],
      ['all',
        ['==', ['get', 'feature'], 'narrow_gauge'],
        ['any',
          ['==', ['get', 'service'], null],
          ['==', ['get', 'service'], 'spur'],
          ['==', ['get', 'service'], 'siding'],
          ['==', ['get', 'service'], 'crossover'],
          ['==', ['get', 'service'], 'yard'],
        ],
      ],
      ['case',
        ['any', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], null]], 2,
        3,
      ],
      ['any',
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['==', ['get', 'feature'], 'rail'],
          ['any', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'usage'], 'branch']],
          ['==', ['get', 'service'], null],
        ],
        ['all',
          ['==', ['get', 'railway'], 'construction'],
          ['any',
            ['==', ['get', 'feature'], 'subway'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'tram'],
            ['==', ['get', 'feature'], 'narrow_gauge'],
            ['==', ['get', 'feature'], 'monorail'],
            ['==', ['get', 'feature'], 'miniature'],
          ],
          ['==', ['get', 'service'], null],
        ],
        ['any',
          ['==', ['get', 'feature'], 'subway'],
          ['==', ['get', 'feature'], 'light_rail'],
          ['==', ['get', 'feature'], 'tram'],
          ['==', ['get', 'feature'], 'monorail'],
          ['==', ['get', 'feature'], 'miniature'],
        ],
      ],
      ['case',
        ['!=', ['get', 'service'], null], 1.5,
        3,
      ],
      0,
    ],
  ];
  const trainProtectionCasingPaint = dashArray => ({
    'line-color': 'white',
    'line-width': railwayLineWidth,
    'line-gap-width': 1,
    'line-dasharray': dashArray,
  });
  const trainProtectionLayout = {
    'line-sort-key': ['get', 'rank'],
    'line-join': 'round',
  };
  const trainProtectionFillPaint = dashArray => ({
    'line-color': ['match', ['get', 'train_protection'],
      'zsi127', '#884400',
      'ptc', '#cc0033',
      'construction_etcs', '#87CEFA',
      'etcs', 'blue',
      'tvm', '#009966',
      'kvb', '#66cc33',
      'asfa', '#ff9092',
      'scmt', '#dd11ff',
      'atc', '#6600cc',
      'atb', '#ff8c00',
      'lzb', 'red',
      'pzb', '#ffb900',
      'other', 'black',
      'grey',
    ],
    'line-width': railwayLineWidth,
    'line-dasharray': dashArray,
  });

  const main_color = '#ff8100';
  const highspeed_color = '#ff0c00';
  const branch_color = '#c4b600';
  const narrow_gauge_color = '#c0da00';
  const no_usage_color = '#000000';
  const disused_color = '#70584d';
  const abandoned_color = '#7f6a62';
  const razed_color = '#94847e';
  const tram_color = '#d877b8';
  const subway_color = '#0300c3';
  const light_rail_color = '#00bd14';
  const siding_color = '#000000';
  const yard_color = '#000000';
  const spur_color = '#87491d';
  const industrial_color = '#87491d';

  const railway_casing_color = '#ffffff';
  const bridge_casing_color = '#000000';

  const turntable_fill = '#ababab';
  const turntable_casing = '#808080';
  const turntable_casing_width = 2;

  const railway_casing_add = 1;

  /* additional width of the casing of dashed lines */
  const railway_tunnel_casing_add = 1;
  const bridge_casing_add = 4;

  const abandoned_dasharray = [2.5, 2.5];
  const razed_dasharray = [1.5, 3.5];
  const construction_dasharray = [4.5, 4.5];
  const proposed_dasharray = [1, 4];

  const standardFillPaint = dashArray => ({
    'line-color': ['case',
      ['==', ['get', 'feature'], 'rail'],
      ['case',
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'spur']], spur_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'yard']], yard_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'crossover']], siding_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], 'siding']], siding_color,
        ['all', ['==', ['get', 'usage'], null], ['==', ['get', 'service'], null]], no_usage_color,
        ['==', ['get', 'usage'], 'industrial'], industrial_color,
        ['==', ['get', 'usage'], 'branch'], branch_color,
        ['all', ['==', ['get', 'usage'], 'main'], ['==', ['get', 'highspeed'], 'yes']], highspeed_color,
        ['==', ['get', 'usage'], 'main'], main_color,
        'rgba(255, 255, 255, 1.0)',
      ],
      ['==', ['get', 'feature'], 'narrow_gauge'],
      ['case',
        ['all', ['==', ['get', 'usage'], 'industrial'], ['==', ['get', 'service'], 'spur']], industrial_color,
        narrow_gauge_color,
      ],
      ['==', ['get', 'railway'], 'disused'], disused_color,
      ['==', ['get', 'railway'], 'abandoned'], abandoned_color,
      ['==', ['get', 'railway'], 'razed'], razed_color,
      ['==', ['get', 'feature'], 'subway'], subway_color,
      ['==', ['get', 'feature'], 'light_rail'], light_rail_color,
      ['==', ['get', 'feature'], 'tram'], tram_color,
      'rgba(255, 255, 255, 1.0)',
    ],
    'line-width': railwayLineWidth,
    'line-dasharray': dashArray,
  });
  const speedCasingPaint = {
    'line-color': 'white',
    'line-width': railwayLineWidth,
    'line-gap-width': 1,
  };
  const speedLayout = {
    'line-join': 'round',
  };
  const maxspeed_fill_color_10 = '#0100CB';
  const maxspeed_fill_color_20 = '#001ECB';
  const maxspeed_fill_color_30 = '#003DCB';
  const maxspeed_fill_color_40 = '#005BCB';
  const maxspeed_fill_color_50 = '#007ACB';
  const maxspeed_fill_color_60 = '#0098CB';
  const maxspeed_fill_color_70 = '#00B7CB';
  const maxspeed_fill_color_80 = '#00CBC1';
  const maxspeed_fill_color_90 = '#00CBA2';
  const maxspeed_fill_color_100 = '#00CB84';
  const maxspeed_fill_color_110 = '#00CB66';
  const maxspeed_fill_color_120 = '#00CB47';
  const maxspeed_fill_color_130 = '#00CB29';
  const maxspeed_fill_color_140 = '#00CB0A';
  const maxspeed_fill_color_150 = '#14CB00';
  const maxspeed_fill_color_160 = '#33CB00';
  const maxspeed_fill_color_170 = '#51CB00';
  const maxspeed_fill_color_180 = '#70CB00';
  const maxspeed_fill_color_190 = '#8ECB00';
  const maxspeed_fill_color_200 = '#ADCB00';
  const maxspeed_fill_color_210 = '#CBCB00';
  const maxspeed_fill_color_220 = '#CBAD00';
  const maxspeed_fill_color_230 = '#CB8E00';
  const maxspeed_fill_color_240 = '#CB7000';
  const maxspeed_fill_color_250 = '#CB5100';
  const maxspeed_fill_color_260 = '#CB3300';
  const maxspeed_fill_color_270 = '#CB1400';
  const maxspeed_fill_color_280 = '#CB0007';
  const maxspeed_fill_color_290 = '#CB0025';
  const maxspeed_fill_color_300 = '#CB0044';
  const maxspeed_fill_color_320 = '#CB0062';
  const maxspeed_fill_color_340 = '#CB0081';
  const maxspeed_fill_color_360 = '#CB009F';
  const maxspeed_fill_color_380 = '#CB00BD';

  const speedFillPaint = {
    'line-color': ['case',
      ['==', ['get', 'maxspeed'], null], 'gray',
      ['<=', ['get', 'maxspeed'], 10], maxspeed_fill_color_10,
      ['<=', ['get', 'maxspeed'], 20], maxspeed_fill_color_20,
      ['<=', ['get', 'maxspeed'], 30], maxspeed_fill_color_30,
      ['<=', ['get', 'maxspeed'], 40], maxspeed_fill_color_40,
      ['<=', ['get', 'maxspeed'], 50], maxspeed_fill_color_50,
      ['<=', ['get', 'maxspeed'], 60], maxspeed_fill_color_60,
      ['<=', ['get', 'maxspeed'], 70], maxspeed_fill_color_70,
      ['<=', ['get', 'maxspeed'], 80], maxspeed_fill_color_80,
      ['<=', ['get', 'maxspeed'], 90], maxspeed_fill_color_90,
      ['<=', ['get', 'maxspeed'], 100], maxspeed_fill_color_100,
      ['<=', ['get', 'maxspeed'], 110], maxspeed_fill_color_110,
      ['<=', ['get', 'maxspeed'], 120], maxspeed_fill_color_120,
      ['<=', ['get', 'maxspeed'], 130], maxspeed_fill_color_130,
      ['<=', ['get', 'maxspeed'], 140], maxspeed_fill_color_140,
      ['<=', ['get', 'maxspeed'], 150], maxspeed_fill_color_150,
      ['<=', ['get', 'maxspeed'], 160], maxspeed_fill_color_160,
      ['<=', ['get', 'maxspeed'], 170], maxspeed_fill_color_170,
      ['<=', ['get', 'maxspeed'], 180], maxspeed_fill_color_180,
      ['<=', ['get', 'maxspeed'], 190], maxspeed_fill_color_190,
      ['<=', ['get', 'maxspeed'], 200], maxspeed_fill_color_200,
      ['<=', ['get', 'maxspeed'], 210], maxspeed_fill_color_210,
      ['<=', ['get', 'maxspeed'], 220], maxspeed_fill_color_220,
      ['<=', ['get', 'maxspeed'], 230], maxspeed_fill_color_230,
      ['<=', ['get', 'maxspeed'], 240], maxspeed_fill_color_240,
      ['<=', ['get', 'maxspeed'], 250], maxspeed_fill_color_250,
      ['<=', ['get', 'maxspeed'], 260], maxspeed_fill_color_260,
      ['<=', ['get', 'maxspeed'], 270], maxspeed_fill_color_270,
      ['<=', ['get', 'maxspeed'], 280], maxspeed_fill_color_280,
      ['<=', ['get', 'maxspeed'], 290], maxspeed_fill_color_290,
      ['<=', ['get', 'maxspeed'], 300], maxspeed_fill_color_300,
      ['<=', ['get', 'maxspeed'], 320], maxspeed_fill_color_320,
      ['<=', ['get', 'maxspeed'], 340], maxspeed_fill_color_340,
      ['<=', ['get', 'maxspeed'], 360], maxspeed_fill_color_360,
      ['>', ['get', 'maxspeed'], 360], maxspeed_fill_color_380,
      'gray',
    ],
    'line-width': railwayLineWidth,
  };

  const electrification_construction_dashes = [2.5, 2.5];
  const electrification_proposed_dashes = [2, 4];

  const color_no = 'black';
  const color_delectrified = '#70584D';
  const color_lt750v_dc = '#FF79B8';
  const color_750v_dc = '#F930FF';
  const color_gt750v_lt1kv_dc = '#D033FF';
  const color_1kv_dc = '#5C1CCB';
  const color_gt1kv_lt1500v_dc = '#007ACB';
  const color_1500v_dc = '#0098CB';
  const color_gt1500v_lt3kv_dc = '#00B7CB';
  const color_3kv_dc = '#0000FF';
  const color_gt3kv_dc = '#1969FF';
  const color_lt15kv_ac = '#97FF2F';
  const color_gte15kv_lt25kv_ac = '#F1F100';
  const color_gte25kv_ac = '#FF9F19';
  const color_15kv_16_67hz = '#00FF00';
  const color_15kv_16_7hz = '#00CB66';
  const color_25kv_50hz = '#FF0000';
  const color_25kv_60hz = '#C00000';
  const color_12kv_25hz = '#CCCC00';
  const color_12_5kv_60hz = '#999900';
  const color_20kv_50hz = '#FFCC66';
  const color_20kv_60hz = '#FF9966';

  const electrificationCasingPaint = {
    'line-color': 'white',
    'line-width': railwayLineWidth,
    'line-gap-width': 0.75,
  };

  const electrificationFillPaint = dashArray => ({
    'line-color': ['case',
      ['all', ['==', ['get', 'frequency'], 60], ['==', ['get', 'voltage'], 25000]], color_25kv_60hz,
      ['all', ['==', ['get', 'frequency'], 50], ['==', ['get', 'voltage'], 25000]], color_25kv_50hz,
      ['all', ['==', ['get', 'frequency'], 60], ['==', ['get', 'voltage'], 20000]], color_20kv_60hz,
      ['all', ['==', ['get', 'frequency'], 50], ['==', ['get', 'voltage'], 20000]], color_20kv_50hz,
      ['all', ['==', ['get', 'frequency'], 16.7], ['==', ['get', 'voltage'], 15000]], color_15kv_16_7hz,
      ['all', ['==', ['get', 'frequency'], 16.67], ['==', ['get', 'voltage'], 15000]], color_15kv_16_67hz,
      ['all', ['==', ['get', 'frequency'], 60], ['==', ['get', 'voltage'], 12500]], color_12_5kv_60hz,
      ['all', ['==', ['get', 'frequency'], 25], ['==', ['get', 'voltage'], 12000]], color_12kv_25hz,
      ['all', ['==', ['get', 'frequency'], 0], ['!=', ['get', 'voltage'], null], ['>', ['get', 'voltage'], 3000]], color_gt3kv_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['==', ['get', 'voltage'], 3000]], color_3kv_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['!=', ['get', 'voltage'], null], ['>', 3000, ['get', 'voltage']], ['>', ['get', 'voltage'], 1500]], color_gt1500v_lt3kv_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['==', ['get', 'voltage'], 1500]], color_1500v_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['!=', ['get', 'voltage'], null], ['>', 1500, ['get', 'voltage']], ['>', ['get', 'voltage'], 1000]], color_gt1kv_lt1500v_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['==', ['get', 'voltage'], 1000]], color_1kv_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['!=', ['get', 'voltage'], null], ['>', 1000, ['get', 'voltage']], ['>', ['get', 'voltage'], 750]], color_gt750v_lt1kv_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['==', ['get', 'voltage'], 750]], color_750v_dc,
      ['all', ['==', ['get', 'frequency'], 0], ['!=', ['get', 'voltage'], null], ['>', 750, ['get', 'voltage']]], color_lt750v_dc,
      ['all',
        ['!=', ['get', 'frequency'], 0],
        ['!=', ['get', 'voltage'], null],
        ['any',
          ['>', ['get', 'voltage'], 25000],
          ['all', ['!=', ['get', 'frequency'], 50], ['!=', ['get', 'frequency'], 60], ['>', ['get', 'voltage'], 25000]],
        ],
      ], color_gte25kv_ac,
      ['all',
        ['!=', ['get', 'frequency'], 0],
        ['!=', ['get', 'voltage'], null],
        ['any',
          ['all', ['!=', ['get', 'frequency'], 16.67], ['!=', ['get', 'frequency'], '16.7'], ['==', ['get', 'voltage'], 15000]],
          ['all', ['>', 20000, ['get', 'voltage']], ['>', ['get', 'voltage'], 15000]],
          ['all', ['!=', ['get', 'frequency'], 50], ['!=', ['get', 'frequency'], '60'], ['==', ['get', 'voltage'], 20000]],
          ['all', ['>', 25000, ['get', 'voltage']], ['>', ['get', 'voltage'], 20000]],
        ],
      ], color_gte15kv_lt25kv_ac,
      ['all',
        ['!=', ['get', 'frequency'], 0],
        ['!=', ['get', 'voltage'], null],
        ['any',
          ['>', 12000, ['get', 'voltage']],
          ['all', ['!=', ['get', 'frequency'], 25], ['==', ['get', 'voltage'], 12000]],
          ['all', ['>', 12500, ['get', 'voltage']], ['>', ['get', 'voltage'], 12000]],
          ['all', ['!=', ['get', 'frequency'], 60], ['==', ['get', 'voltage'], 12500]],
          ['all', ['>', 15000, ['get', 'voltage']], ['>', ['get', 'voltage'], 12500]],
        ],
      ], color_lt15kv_ac,
      ['any',
        ['==', ['get', 'state'], 'deelectrified'],
        ['==', ['get', 'state'], 'abandoned'],
      ], color_delectrified,
      ['==', ['get', 'state'], 'no'], color_no,
      'gray',
    ],
    'line-width': railwayLineWidth,
    'line-dasharray': dashArray,
  });
  const electrificationLayout = {
    'line-join': 'round',
  };

  const gauge_construction_dashes = [3, 3];
  const dual_construction_dashes = [1.5, 4.5];
  const multi_construction_dashes = [0, 1, 1, 4];
  const gauge_dual_gauge_dashes = [4.5, 4.5];
  const gauge_multi_gauge_dashes = [0, 3, 3, 3];

  const color_gauge_0064 = '#006060';
  const color_gauge_0089 = '#008080';
  const color_gauge_0127 = '#00A0A0';
  const color_gauge_0184 = '#00C0C0';
  const color_gauge_0190 = '#00E0E0';
  const color_gauge_0260 = '#00FFFF';
  const color_gauge_0381 = '#80FFFF';
  const color_gauge_0500 = '#A0FFFF';
  const color_gauge_0597 = '#C0FFFF';
  const color_gauge_0600 = '#E0FFFF';
  const color_gauge_0610 = '#FFE0FF';
  const color_gauge_0700 = '#FFC0FF';
  const color_gauge_0750 = '#FFA0FF';
  const color_gauge_0760 = '#FF80FF';
  const color_gauge_0762 = '#FF60FF';
  const color_gauge_0785 = '#FF40FF';
  const color_gauge_0800 = '#FF00FF';
  const color_gauge_0891 = '#E000FF';
  const color_gauge_0900 = '#C000FF';
  const color_gauge_0914 = '#A000FF';
  const color_gauge_0950 = '#8000FF';
  const color_gauge_1000 = '#6000FF';
  const color_gauge_1009 = '#4000FF';
  const color_gauge_1050 = '#0000FF';
  const color_gauge_1067 = '#0000E0';
  const color_gauge_1100 = '#0000C0';
  const color_gauge_1200 = '#0000A0';
  const color_gauge_1372 = '#000080';
  const color_gauge_1422 = '#000060';
  const color_gauge_1432 = '#000040';
  const color_gauge_1435 = '#000000';
  const color_gauge_1440 = '#400000';
  const color_gauge_1445 = '#600000';
  const color_gauge_1450 = '#700000';
  const color_gauge_1458 = '#800000';
  const color_gauge_1495 = '#A00000';
  const color_gauge_1520 = '#C00000';
  const color_gauge_1522 = '#E00000';
  const color_gauge_1524 = '#FF0000';
  const color_gauge_1581 = '#FF6000';
  const color_gauge_1588 = '#FF8000';
  const color_gauge_1600 = '#FFA000';
  const color_gauge_1668 = '#FFC000';
  const color_gauge_1676 = '#FFE000';
  const color_gauge_1700 = '#FFFF00';
  const color_gauge_1800 = '#E0FF00';
  const color_gauge_1880 = '#C0FF00';
  const color_gauge_2000 = '#A0FF00';
  const color_gauge_miniature = '#80C0C0';
  const color_gauge_monorail = '#C0C080';
  const color_gauge_broad = '#FFC0C0';
  const color_gauge_narrow = '#C0C0FF';
  const color_gauge_standard = '#808080';
  const color_gauge_unknown = '#C0C0C0';

  const gaugeCasingPaint = {
    'line-color': 'white',
    'line-width': railwayLineWidth,
    'line-gap-width': 0.75,
  };

  const gaugeFillPaint = (gaugeProperty, gaugeIntProperty, dashArray) => ({
    'line-color': ['case',
      // monorails or tracks with monorail gauge value
      ['any',
        ['==', ['get', 'railway'], 'monorail'],
        ['all',
          ['==', ['get', gaugeProperty], 'monorail'],
          ['any',
            ['==', ['get', 'railway'], 'rail'],
            ['==', ['get', 'railway'], 'light_rail'],
            ['==', ['get', 'railway'], 'subway'],
            ['==', ['get', 'railway'], 'tram'],
          ],
        ],
      ], color_gauge_monorail,
      // other tracks with inaccurate gauge value
      ['all',
        ['==', ['get', gaugeProperty], 'standard'],
        ['any',
          ['==', ['get', 'railway'], 'rail'],
          ['==', ['get', 'railway'], 'light_rail'],
          ['==', ['get', 'railway'], 'subway'],
          ['==', ['get', 'railway'], 'tram'],
        ],
      ], color_gauge_standard,
      ['all',
        ['==', ['get', gaugeProperty], 'broad'],
        ['any',
          ['==', ['get', 'railway'], 'rail'],
          ['==', ['get', 'railway'], 'light_rail'],
          ['==', ['get', 'railway'], 'subway'],
          ['==', ['get', 'railway'], 'tram'],
        ],
      ], color_gauge_broad,
      ['any',
        ['all',
          ['==', ['get', gaugeProperty], 'narrow'],
          ['any',
            ['==', ['get', 'railway'], 'rail'],
            ['==', ['get', 'railway'], 'light_rail'],
            ['==', ['get', 'railway'], 'subway'],
            ['==', ['get', 'railway'], 'tram'],
          ],
        ],
        ['all',
          ['==', ['get', 'railway'], 'narrow_gauge'],
          ['any',
            ['==', ['get', gaugeProperty], 'narrow'],
            ['==', ['get', gaugeProperty], 'broad'],
            ['==', ['get', gaugeProperty], 'standard'],
            ['==', ['get', gaugeProperty], 'unknown'],
            ['==', ['get', gaugeProperty], null],
          ],
        ],
      ], color_gauge_narrow,
      // miniature tracks with inaccurate gauge value
      ['all',
        ['==', ['get', 'railway'], 'miniature'],
        ['any',
          ['==', ['get', gaugeProperty], 'narrow'],
          ['==', ['get', gaugeProperty], 'broad'],
          ['==', ['get', gaugeProperty], 'standard'],
          ['==', ['get', gaugeProperty], 'unknown'],
          ['==', ['get', gaugeProperty], null],
        ],
      ], color_gauge_miniature,
      // unknown high numeric gauge values
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>=', ['get', gaugeIntProperty], 3000]], color_gauge_unknown,
      // colors for numeric gauge values
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 88, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 63]], color_gauge_0064,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 127, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 88]], color_gauge_0089,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 184, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 127]], color_gauge_0127,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 190, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 184]], color_gauge_0184,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 260, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 190]], color_gauge_0190,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 380, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 260]], color_gauge_0260,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 500, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 380]], color_gauge_0381,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 597, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 500]], color_gauge_0500,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 600, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 597]], color_gauge_0597,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 609, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 600]], color_gauge_0600,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 700, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 609]], color_gauge_0610,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 750, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 700]], color_gauge_0700,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 760, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 750]], color_gauge_0750,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 762, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 760]], color_gauge_0760,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 785, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 762]], color_gauge_0762,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 800, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 785]], color_gauge_0785,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 891, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 800]], color_gauge_0800,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 900, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 891]], color_gauge_0891,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 914, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 900]], color_gauge_0900,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 950, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 914]], color_gauge_0914,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1000, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 950]], color_gauge_0950,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1009, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1000]], color_gauge_1000,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1050, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1009]], color_gauge_1009,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1066, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1050]], color_gauge_1050,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1100, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1066]], color_gauge_1067,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1200, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1100]], color_gauge_1100,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1372, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1200]], color_gauge_1200,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1422, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1372]], color_gauge_1372,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1432, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1422]], color_gauge_1422,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1435, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1432]], color_gauge_1432,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1440, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1435]], color_gauge_1435,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1445, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1440]], color_gauge_1440,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1450, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1445]], color_gauge_1445,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1458, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1450]], color_gauge_1450,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1495, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1458]], color_gauge_1458,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1520, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1495]], color_gauge_1495,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1522, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1520]], color_gauge_1520,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1524, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1522]], color_gauge_1522,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1581, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1524]], color_gauge_1524,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1588, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1581]], color_gauge_1581,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1600, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1588]], color_gauge_1588,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1668, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1600]], color_gauge_1600,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1672, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1668]], color_gauge_1668,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1700, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1672]], color_gauge_1676,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1800, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1700]], color_gauge_1700,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 1880, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1800]], color_gauge_1800,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 2000, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 1880]], color_gauge_1880,
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 3000, ['get', gaugeIntProperty]], ['>=', ['get', gaugeIntProperty], 2000]], color_gauge_2000,
      // color for unknown low numeric gauge values
      ['all', ['!=', ['get', gaugeIntProperty], null], ['>', 63, ['get', gaugeIntProperty]], ['>', ['get', gaugeIntProperty], 0]], color_gauge_unknown,
      'gray',
    ],
    'line-width': railwayLineWidth,
    'line-dasharray': dashArray,
  });
  const gaugeLayout = {
    'line-join': 'round',
  };

  const attribution = '<a href="https://github.com/hiddewie/OpenRailwayMap-vector" target="_blank">&copy; OpenRailwayMap contributors</a>';

  const openstreetmap = {
    type: 'raster',
    tiles: [
      'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
    ],
    tileSize: 256,
    attribution: '<a href="https://www.openstreetmap.org/about" target="_blank">&copy; OpenStreetMap contributors</a>'
  };
  const sources = {
    standard: {
      openstreetmap,
      openrailwaymap: {
        type: 'vector',
        url: `${location.origin}/standard`,
        attribution,
      },
    },
    speed: {
      openstreetmap,
      openrailwaymap: {
        type: 'vector',
        url: `${location.origin}/speed`,
        attribution,
      },
    },
    signals: {
      openstreetmap,
      openrailwaymap: {
        type: 'vector',
        url: `${location.origin}/signals`,
        attribution,
      },
    },
    electrification: {
      openstreetmap,
      openrailwaymap: {
        type: 'vector',
        url: `${location.origin}/electrification`,
        attribution,
      },
    },
    gauge: {
      openstreetmap,
      openrailwaymap: {
        type: 'vector',
        url: `${location.origin}/gauge`,
        attribution,
      },
    },
  };

  const backgroundColor = {
    id: 'background',
    type: 'background',
    paint: {
      'background-color': 'rgb(242, 243, 240)'
    }
  };
  const backgroundMap = {
    id: "openstreetmap",
    type: "raster",
    source: "openstreetmap",
    paint: {
      'raster-saturation': -1.0, // or 0.0 for colorful
    }
  };

  const layers = {
    standard: [
      backgroundColor,
      backgroundMap,
      {
        id: 'railway_bridge_railing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['get', 'bridge'],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        paint: {
          'line-color': bridge_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': bridge_casing_add,
        }
      },
      {
        id: 'railway_tunnel_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['get', 'tunnel'],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_tunnel_casing_add,
        }
      },
      {
        id: 'railway_line_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['!', ['get', 'bridge']],
          ['!', ['get', 'tunnel']],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_line_construction_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'construction'],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
          'line-dasharray': construction_dasharray,
        }
      },
      {
        id: 'railway_line_proposed_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'proposed'],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
          'line-dasharray': proposed_dasharray,
        }
      },
      {
        id: 'railway_line_abandoned_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'abandoned'],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
          'line-dasharray': abandoned_dasharray,
        }
      },
      {
        id: 'railway_line_razed_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'razed'],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
          'line-dasharray': razed_dasharray,
        }
      },
      {
        id: 'railway_line_med_casing',
        type: 'line',
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_med',
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_bridge_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['get', 'bridge'],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: {
          'line-color': railway_casing_color,
          'line-width': railwayLineWidth,
          'line-gap-width': railway_casing_add,
        }
      },
      {
        id: 'railway_tunnel_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['get', 'tunnel'],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_tunnel_bright',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['get', 'tunnel'],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: {
          ...standardFillPaint([1]),
          'line-color': 'rgba(255, 255, 255, 50%)',
        }
      },
      {
        id: 'railway_construction_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'construction'],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint(construction_dasharray),
      },
      {
        id: 'railway_proposed_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'proposed'],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint(proposed_dasharray),
      },
      {
        id: 'railway_abandoned_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'abandoned'],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint(abandoned_dasharray),
      },
      {
        id: 'railway_razed_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['==', ['get', 'railway'], 'razed'],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint(razed_dasharray),
      },
      {
        id: 'railway_line_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['!', ['get', 'bridge']],
          ['!', ['get', 'tunnel']],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_line_med_fill',
        type: 'line',
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_med',
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_bridge_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['all',
          ['get', 'bridge'],
          ['!=', ['get', 'railway'], 'construction'],
          ['!=', ['get', 'railway'], 'proposed'],
          ['!=', ['get', 'railway'], 'abandoned'],
          ['!=', ['get', 'railway'], 'razed'],
        ],
        layout: {
          'line-join': 'round',
        },
        paint: standardFillPaint([1]),
      },
      {
        id: 'railway_turntables_fill',
        type: 'fill',
        minzoom: 10,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_turntables',
        paint: {
          'fill-color': turntable_fill,
        }
      },
      {
        id: 'railway_turntables_casing',
        type: 'line',
        minzoom: 15,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_turntables',
        paint: {
          'line-color': turntable_casing,
          'line-width': turntable_casing_width,
        }
      },
      {
        id: 'railway_symbols_tram_stop',
        type: 'symbol',
        minzoom: 12,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_symbols',
        filter: ['==', ['get', 'railway'], 'tram_stop'],
        layout: {
          'icon-overlap': 'always',
          'icon-image': 'general/tram-stop',
        }
      },
      {
        id: 'railway_text_stations',
        type: 'symbol',
        minzoom: 5,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_text_stations',
        filter: ['step', ['zoom'],
          ['all',
            ['==', ['get', 'railway'], 'station'],
            ['!=', ['get', 'station'], 'light_rail'],
            ['!=', ['get', 'station'], 'subway'],
            ['!=', ['get', 'station'], 'funicular'],
          ],
          9,
          ['all',
            ['any',
              ['==', ['get', 'railway'], 'station'],
              ['==', ['get', 'railway'], 'halt'],
            ],
            ['!=', ['get', 'station'], 'funicular'],
          ],
          10,
          ['all',
            ['!=', ['get', 'railway'], 'tram_stop'],
            ['!=', ['get', 'station'], 'funicular'],
          ],
          13,
          ['!=', ['get', 'station'], 'funicular'],
        ],
        paint: {
          'text-color': ['case',
            ['==', ['get', 'railway'], 'yard'], '#87491D',
            ['==', ['get', 'railway'], 'tram_stop'], '#D877B8',
            ['==', ['get', 'railway'], 'station'], 'blue',
            ['==', ['get', 'railway'], 'halt'], 'blue',
            '#616161',
          ],
          'text-halo-color': ['case',
            ['==', ['get', 'railway'], 'yard'], '#F1F1F1',
            ['==', ['get', 'railway'], 'tram_stop'], 'white',
            ['==', ['get', 'railway'], 'station'], 'white',
            ['==', ['get', 'railway'], 'halt'], 'white',
            '#F1F1F1',
          ],
          'text-halo-width': 1.5,
        },
        layout: {
          'symbol-z-order': 'source',
          'text-field': ['step', ['zoom'],
            ['get', 'label'],
            10,
            ['get', 'name'],
          ],
          // TODO light rail / subway oblique font
          'text-font': ['Noto Sans Bold'],
          // TODO text-variable-anchor-offset
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'text-offset': ['case',
            ['==', ['get', 'railway'], 'tram_stop'], ['literal', [0, 1]],
            ['literal', [0, 0]]
          ],
        },
      },
      {
        id: 'railway_symbols_low',
        type: 'symbol',
        minzoom: 10,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_symbols',
        filter: ['==', ['get', 'railway'], 'border'],
        layout: {
          'icon-image': 'general/border',
        }
      },
      {
        id: 'railway_symbols_med',
        type: 'symbol',
        minzoom: 12,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_symbols',
        filter: ['any',
          ['==', ['get', 'railway'], 'owner_change'],
          ['==', ['get', 'railway'], 'radio'],
        ],
        layout: {
          'symbol-z-order': 'source',
          'icon-image': ['case',
            ['==', ['get', 'railway'], 'owner_change'], 'general/border',
            ['==', ['get', 'railway'], 'radio'], ['case',
              ['==', ['get', 'man_made'], 'mast'], 'general/radio-mast',
              ['==', ['get', 'man_made'], 'tower'], 'general/radio-mast',
              ['==', ['get', 'man_made'], 'antenna'], 'general/radio-antenna',
              '',
            ],
            '',
          ],
        }
      },
      {
        id: 'railway_symbols_med_high',
        type: 'symbol',
        minzoom: 13,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_symbols',
        filter: ['any',
          ['==', ['get', 'railway'], 'crossing'],
          ['==', ['get', 'railway'], 'level_crossing'],
        ],
        layout: {
          'symbol-z-order': 'source',
          'icon-image': ['case',
            ['==', ['get', 'railway'], 'level_crossing'], 'general/level-crossing',
            ['==', ['get', 'railway'], 'crossing'], 'general/crossing',
            '',
          ],
        }
      },
      {
        id: 'railway_symbols_high',
        type: 'symbol',
        minzoom: 16,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_symbols',
        filter: ['==', ['get', 'railway'], 'phone'],
        layout: {
          'symbol-z-order': 'source',
          'icon-image': 'general/phone',
        }
      },
      {
        id: 'railway_text',
        type: 'symbol',
        minzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['step', ['zoom'],
          ['all',
            ['!=', ['get', 'ref'], null],
            ['==', ['get', 'railway'], 'rail'],
            ['any',
              ['==', ['get', 'usage'], 'main'],
              ['==', ['get', 'usage'], 'branch'],
            ],
            ['==', ['get', 'service'], null],
          ],
          8,
          ['all',
            ['!=', ['get', 'ref'], null],
            ['any',
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'disused'],
                  ['==', ['get', 'railway'], 'abandoned'],
                ],
                ['==', ['get', 'feature'], 'rail'],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'construction'],
                  ['==', ['get', 'railway'], 'proposed'],
                ],
                ['==', ['get', 'feature'], 'rail'],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
            ],
          ],
          9,
          ['all',
            ['!=', ['get', 'ref'], null],
            ['any',
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                  ['==', ['get', 'usage'], 'industrial'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'narrow_gauge'],
                  ['==', ['get', 'railway'], 'subway'],
                  ['==', ['get', 'railway'], 'light_rail'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'disused'],
                  ['==', ['get', 'railway'], 'abandoned'],
                  ['==', ['get', 'railway'], 'razed'],
                ],
                ['==', ['get', 'feature'], 'rail'],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'construction'],
                  ['==', ['get', 'railway'], 'proposed'],
                ],
                ['any',
                  ['==', ['get', 'feature'], 'rail'],
                  ['==', ['get', 'feature'], 'subway'],
                  ['==', ['get', 'feature'], 'light_rail'],
                ],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
            ],
          ],
          10,
          ['all',
            ['!=', ['get', 'ref'], null],
            ['any',
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['==', ['get', 'usage'], 'industrial'],
              ],
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['==', ['get', 'usage'], null],
                ['any',
                  ['==', ['get', 'service'], 'siding'],
                  ['==', ['get', 'service'], 'crossover'],
                  ['==', ['get', 'service'], 'spur'],
                ],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'narrow_gauge'],
                  ['==', ['get', 'railway'], 'subway'],
                  ['==', ['get', 'railway'], 'light_rail'],
                ],
                ['any',
                  ['==', ['get', 'service'], null],
                  ['==', ['get', 'service'], 'siding'],
                  ['==', ['get', 'service'], 'crossover'],
                  ['==', ['get', 'service'], 'spur'],
                ],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'disused'],
                  ['==', ['get', 'railway'], 'abandoned'],
                  ['==', ['get', 'railway'], 'razed'],
                ],
                ['any',
                  ['==', ['get', 'feature'], 'rail'],
                  ['==', ['get', 'feature'], 'subway'],
                  ['==', ['get', 'feature'], 'light_rail'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'construction'],
                  ['==', ['get', 'railway'], 'proposed'],
                ],
                ['any',
                  ['==', ['get', 'feature'], 'rail'],
                  ['==', ['get', 'feature'], 'subway'],
                  ['==', ['get', 'feature'], 'light_rail'],
                  ['==', ['get', 'feature'], 'tram'],
                ],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['==', ['get', 'railway'], 'tram'],
                ['==', ['get', 'service'], null],
              ],
            ],
          ],
          11,
          ['all',
            ['!=', ['get', 'ref'], null],
            ['any',
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['==', ['get', 'usage'], 'industrial'],
              ],
              ['all',
                ['==', ['get', 'railway'], 'rail'],
                ['==', ['get', 'usage'], null],
                ['any',
                  ['==', ['get', 'service'], 'siding'],
                  ['==', ['get', 'service'], 'crossover'],
                  ['==', ['get', 'service'], 'spur'],
                  ['==', ['get', 'service'], 'yard'],
                ],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'narrow_gauge'],
                  ['==', ['get', 'railway'], 'subway'],
                  ['==', ['get', 'railway'], 'light_rail'],
                ],
                ['any',
                  ['==', ['get', 'service'], null],
                  ['==', ['get', 'service'], 'siding'],
                  ['==', ['get', 'service'], 'crossover'],
                  ['==', ['get', 'service'], 'spur'],
                  ['==', ['get', 'service'], 'yard'],
                ],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'disused'],
                  ['==', ['get', 'railway'], 'abandoned'],
                  ['==', ['get', 'railway'], 'razed'],
                ],
                ['any',
                  ['==', ['get', 'feature'], 'rail'],
                  ['==', ['get', 'feature'], 'subway'],
                  ['==', ['get', 'feature'], 'light_rail'],
                  ['==', ['get', 'feature'], 'tram'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['any',
                  ['==', ['get', 'railway'], 'construction'],
                  ['==', ['get', 'railway'], 'proposed'],
                ],
                ['any',
                  ['==', ['get', 'feature'], 'rail'],
                  ['==', ['get', 'feature'], 'subway'],
                  ['==', ['get', 'feature'], 'light_rail'],
                  ['==', ['get', 'feature'], 'tram'],
                ],
                ['any',
                  ['==', ['get', 'usage'], 'main'],
                  ['==', ['get', 'usage'], 'branch'],
                ],
                ['==', ['get', 'service'], null],
              ],
              ['all',
                ['==', ['get', 'railway'], 'tram'],
                ['==', ['get', 'service'], null],
              ],
            ],
          ],
          12,
          ['!=', ['get', 'ref'], null],
          14,
          ['!=', ['get', 'label'], null],
        ],
        paint: {
          'text-color': '#585858',
          'text-halo-color': 'white',
          'text-halo-width': 2,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': ['step', ['zoom'],
            ['get', 'ref'],
            14,
            ['get', 'label'],
          ],
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 10,
          'text-max-width': 5,
          'symbol-spacing': 200,
        },
      },
      {
        id: 'railway_text_km',
        type: 'symbol',
        minzoom: 10,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_text_km',
        filter: ['step', ['zoom'],
          ['get', 'zero'],
          13,
          true,
        ],
        paint: {
          'text-color': 'black',
          'text-halo-color': 'white',
          'text-halo-width': 1,
        },
        layout: {
          'symbol-z-order': 'source',
          'text-field': '{pos}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
        },
      },
      {
        id: 'railway_switch_ref',
        type: 'symbol',
        minzoom: 15,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_switch_ref',
        paint: {
          'text-halo-color': ['case',
            ['==', ['get', 'railway_local_operated'], 'yes'], 'yellow',
            'white'
          ],
          'text-halo-width': 2,
        },
        layout: {
          'symbol-z-order': 'source',
          'text-field': '{ref}',
          'text-font': ['Noto Sans Medium'],
          'text-size': 11,
          'text-padding': 20,
        },
      },
      {
        id: 'railway_text_track_numbers',
        type: 'symbol',
        minzoom: 16,
        source: 'openrailwaymap',
        'source-layer': 'standard_railway_line_fill',
        filter: ['!=', ['get', 'track_ref'], null],
        paint: {
          'text-color': 'white',
          'text-halo-color': 'blue',
          'text-halo-width': 4,
          'text-halo-blur': 2,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': '{track_ref}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 10,
          'text-padding': 10,
        },
      },
    ],

    speed: [
      backgroundColor,
      backgroundMap,
      {
        id: 'speed_railway_line_low_casing',
        type: 'line',
        source: 'openrailwaymap',
        maxzoom: 7,
        'source-layer': 'speed_railway_line_med',
        filter: ['==', ['get', 'usage'], 'main'],
        paint: speedCasingPaint,
        layout: speedLayout,
      },
      {
        id: 'speed_railway_line_med_casing',
        type: 'line',
        source: 'openrailwaymap',
        minzoom: 7,
        maxzoom: 8,
        'source-layer': 'speed_railway_line_med',
        paint: speedCasingPaint,
        layout: speedLayout,
      },
      {
        id: 'speed_railway_line_casing',
        type: 'line',
        source: 'openrailwaymap',
        minzoom: 8,
        'source-layer': 'speed_railway_line_casing',
        paint: speedCasingPaint,
        layout: speedLayout,
      },
      {
        id: 'speed_railway_line_low_fill',
        type: 'line',
        source: 'openrailwaymap',
        maxzoom: 7,
        'source-layer': 'speed_railway_line_med',
        filter: ['==', ['get', 'usage'], 'main'],
        paint: speedFillPaint,
        layout: speedLayout,
      },
      {
        id: 'speed_railway_line_med_fill',
        type: 'line',
        source: 'openrailwaymap',
        minzoom: 7,
        maxzoom: 8,
        'source-layer': 'speed_railway_line_med',
        paint: speedFillPaint,
        layout: speedLayout,
      },
      {
        id: 'speed_railway_line_fill',
        type: 'line',
        source: 'openrailwaymap',
        minzoom: 8,
        'source-layer': 'speed_railway_line_fill',
        paint: speedFillPaint,
        layout: speedLayout,
      },
      {
        id: 'speed_railway_signal_direction',
        type: 'symbol',
        minzoom: 13,
        source: 'openrailwaymap',
        'source-layer': 'speed_railway_signals',
        filter: ['step', ['zoom'],
          ['all',
            ['!=', ['get', 'feature'], null],
            ['!=', ['get', 'azimuth'], null],
            ['==', ['get', 'type'], 'line'],
          ],
          14,
          ['all',
            ['!=', ['get', 'feature'], null],
            ['!=', ['get', 'azimuth'], null],
            ['any',
              ['==', ['get', 'type'], 'line'],
              ['==', ['get', 'type'], 'tram'],
            ]
          ],
          16,
          ['all',
            ['!=', ['get', 'feature'], null],
            ['!=', ['get', 'azimuth'], null],
          ],
        ],
        layout: {
          'icon-overlap': 'always',
          'icon-image': 'general/signal-direction',
          'icon-offset': ['literal', [0, 15]],
          'icon-rotate': ['get', 'azimuth'],
        }
      },
      {
        id: 'speed_railway_signals',
        type: 'symbol',
        source: 'openrailwaymap',
        minzoom: 13,
        'source-layer': 'speed_railway_signals',
        filter: ['step', ['zoom'],
          ['all',
            ['!=', ['get', 'feature'], null],
            ['==', ['get', 'type'], 'line'],
          ],
          14,
          ['all',
            ['!=', ['get', 'feature'], null],
            ['any',
              ['==', ['get', 'type'], 'line'],
              ['==', ['get', 'type'], 'tram'],
            ]
          ],
          16,
          ['!=', ['get', 'feature'], null],
        ],
        paint: {
          // TODO https://github.com/maplibre/martin/issues/1075
          // 'icon-halo-color': 'rgba(255, 255, 255, 1)',
          // 'icon-halo-blur': 0,
          // 'icon-halo-width': 2.0,
        },
        layout: {
          'symbol-z-order': 'source',
          'icon-overlap': 'always',
          'icon-image': ['image', ['get', 'feature']],
        }
      },
      {
        id: 'speed_railway_signals_unknown',
        type: 'circle',
        source: 'openrailwaymap',
        'source-layer': 'speed_railway_signals',
        filter: ['==', ['get', 'feature'], null],
        paint: {
          'circle-color': '#f00',
          'circle-blur': 1,
        },
      },
      {
        id: 'speed_railway_line_text',
        type: 'symbol',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'speed_railway_line_fill',
        // TODO zoom filters do not match line zoom levels
        filter: ['step', ['zoom'],
          ['==', ['get', 'feature'], 'rail'],
          10,
          ['any',
            ['==', ['get', 'feature'], 'rail'],
            ['==', ['get', 'feature'], 'narrow_gauge'],
          ],
          11,
          ['any',
            ['==', ['get', 'feature'], 'rail'],
            ['==', ['get', 'feature'], 'narrow_gauge'],
            ['==', ['get', 'feature'], 'light_rail'],
            ['==', ['get', 'feature'], 'subway'],
          ],
          12,
          true,
        ],
        paint: {
          'text-halo-color': 'white',
          'text-halo-width': 1.5,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': '{label}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 30,
          'symbol-spacing': 100,
        },
      },
    ],

    signals: [
      backgroundColor,
      backgroundMap,
      {
        id: 'railway_line_low_casing',
        type: 'line',
        source: 'openrailwaymap',
        maxzoom: 7,
        'source-layer': 'signals_railway_line',
        filter: ['all',
          ['==', ['get', 'railway'], 'rail'],
          ['==', ['get', 'usage'], 'main'],
          ['==', ['get', 'service'], null],
        ],
        paint: trainProtectionCasingPaint([1]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_med_casing',
        type: 'line',
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_line',
        filter: ['all',
          ['==', ['get', 'railway'], 'rail'],
          ['any',
            ['==', ['get', 'usage'], 'main'],
            ['==', ['get', 'usage'], 'branch'],
          ],
          ['==', ['get', 'service'], null],
        ],
        paint: trainProtectionCasingPaint([1]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_casing_construction',
        type: 'line',
        source: 'openrailwaymap',
        minzoom: 8,
        'source-layer': 'signals_railway_line',
        filter: ['==', ['get', 'railway'], 'construction'],
        paint: trainProtectionCasingPaint([2, 2]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_casing',
        type: 'line',
        source: 'openrailwaymap',
        minzoom: 8,
        'source-layer': 'signals_railway_line',
        filter: ['!=', ['get', 'railway'], 'construction'],
        paint: trainProtectionCasingPaint([1]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_low_fill',
        type: 'line',
        source: 'openrailwaymap',
        maxzoom: 7,
        'source-layer': 'signals_railway_line',
        filter: ['all',
          ['==', ['get', 'railway'], 'rail'],
          ['==', ['get', 'usage'], 'main'],
          ['==', ['get', 'service'], null],
        ],
        paint: trainProtectionFillPaint([1]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_med_fill',
        type: 'line',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_line',
        filter: ['all',
          ['==', ['get', 'railway'], 'rail'],
          ['any',
            ['==', ['get', 'usage'], 'main'],
            ['==', ['get', 'usage'], 'branch'],
          ],
          ['==', ['get', 'service'], null],
        ],
        paint: trainProtectionFillPaint([1]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_fill_construction',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_line',
        filter: ['==', ['get', 'railway'], 'construction'],
        paint: trainProtectionFillPaint([2, 2]),
        layout: trainProtectionLayout,
      },
      {
        id: 'railway_line_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_line',
        filter: ['!=', ['get', 'railway'], 'construction'],
        paint: trainProtectionFillPaint([1]),
        layout: trainProtectionLayout,
      },
      {
        id: 'signal_boxes_point',
        type: 'circle',
        minzoom: 10,
        source: 'openrailwaymap',
        'source-layer': 'signals_signal_boxes',
        filter: ['==', ["geometry-type"], 'Point'],
        paint: {
          'circle-color': '#008206',
          'circle-radius': ['step', ['zoom'],
            6,
            14, 12,
            15, 18,
          ],
          'circle-stroke-color': 'white',
          'circle-stroke-width': 1,
        },
      },
      {
        id: 'signal_boxes_polygon',
        type: 'fill',
        minzoom: 12,
        source: 'openrailwaymap',
        'source-layer': 'signals_signal_boxes',
        filter: ['any',
          ['==', ["geometry-type"], 'Polygon'],
          ['==', ["geometry-type"], 'MultiPolygon'],
        ],
        paint: {
          'fill-color': '#008206',
          'fill-outline-color': 'white',
        },
      },
      {
        id: 'signal_boxes_polygon_outline',
        type: 'line',
        minzoom: 12,
        source: 'openrailwaymap',
        'source-layer': 'signals_signal_boxes',
        filter: ['any',
          ['==', ["geometry-type"], 'Polygon'],
          ['==', ["geometry-type"], 'MultiPolygon'],
        ],
        paint: {
          'line-color': 'white',
          'line-width': 1,
        },
      },
      {
        id: 'railway_signals_unknown',
        type: 'circle',
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_signals',
        filter: ['==', ['get', 'feature'], null],
        paint: {
          'circle-color': '#f00',
          'circle-blur': 1,
        },
      },
      {
        id: 'railway_signals_direction',
        type: 'symbol',
        minzoom: 13,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_signals',
        filter: ['all',
          ['!=', ['get', 'azimuth'], null],
          ['!=', ['get', 'feature'], ''],
        ],
        layout: {
          'symbol-z-order': 'source',
          'icon-overlap': 'always',
          'icon-image': 'general/signal-direction',
          'icon-offset': ['literal', [0, 15]],
          'icon-rotate': ['get', 'azimuth'],
        }
      },
      {
        id: 'railway_signals',
        type: 'symbol',
        minzoom: 13,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_signals',
        paint: {
          // TODO https://github.com/maplibre/martin/issues/1075
          // 'icon-halo-color': 'rgba(255, 255, 255, 1)',
          // 'icon-halo-blur': 0,
          // 'icon-halo-width': 2.0,
        },
        layout: {
          'symbol-z-order': 'source',
          'icon-overlap': 'always',
          'icon-image': ['image', ['get', 'feature']],
        }
      },
      {
        id: 'railway_signals_deactivated',
        type: 'symbol',
        minzoom: 13,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_signals',
        filter: ['get', 'deactivated'],
        layout: {
          'symbol-z-order': 'source',
          'icon-overlap': 'always',
          'icon-image': 'general/signal-deactivated',
        }
      },
      {
        id: 'signal_boxes_text_medium',
        type: 'symbol',
        minzoom: 12,
        maxzoom: 15,
        source: 'openrailwaymap',
        'source-layer': 'signals_signal_boxes',
        paint: {
          'text-color': '#404040',
          'text-halo-color': '#bfffb3',
          'text-halo-width': 1.5,
        },
        layout: {
          'text-field': '{ref}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
        }
      },
      {
        id: 'signal_boxes_text_high',
        type: 'symbol',
        minzoom: 15,
        source: 'openrailwaymap',
        'source-layer': 'signals_signal_boxes',
        paint: {
          'text-color': '#404040',
          'text-halo-color': '#bfffb3',
          'text-halo-width': 1.5,
        },
        layout: {
          'text-field': '{name}',
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
        }
      },
      {
        id: 'railway_signals_text',
        type: 'symbol',
        minzoom: 13,
        source: 'openrailwaymap',
        'source-layer': 'signals_railway_signals',
        filter: ['all',
          ['!=', ['get', 'ref'], null],
          ['!=', ['get', 'feature'], ''],
        ],
        paint: {
          'text-halo-color': 'white',
          'text-halo-width': 1.5,
          'text-halo-blur': 1,
        },
        layout: {
          'text-field': '{ref}',
          'text-font': ['Noto Sans Medium'],
          'text-size': 9,
          'text-anchor': 'top',
          'text-offset': ['case',
            ['==', ['get', 'main_height'], 'dwarf'], ['literal', [0, 1]],
            ['any',
              ['all',
                ['==', ['get', 'main_form'], 'light'],
                ['==', ['get', 'speed_limit_form'], 'light'],
              ],
              ['all',
                ['==', ['get', 'distant_form'], 'light'],
                ['==', ['get', 'speed_limit_form'], 'light'],
              ],
            ], ['literal', [0, 2]],
            ['literal', [0, 1.5]],
          ],
        }
      },
    ],

    electrification: [
      backgroundColor,
      backgroundMap,
      {
        id: 'electrification_railway_line_low_casing',
        type: 'line',
        maxzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line_med',
        filter: ['==', ['get', 'usage'], 'main'],
        paint: electrificationCasingPaint,
        layout: electrificationLayout,
      },
      {
        id: 'electrification_railway_line_med_casing',
        type: 'line',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line_med',
        paint: electrificationCasingPaint,
        layout: electrificationLayout,
      },
      {
        id: 'electrification_railway_line_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line',
        paint: electrificationCasingPaint,
        layout: electrificationLayout,
      },
      {
        id: 'electrification_railway_line_low_fill',
        type: 'line',
        maxzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line_med',
        filter: ['==', ['get', 'usage'], 'main'],
        paint: electrificationFillPaint([1]),
        layout: electrificationLayout,
      },
      {
        id: 'electrification_railway_line_med_fill',
        type: 'line',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line_med',
        paint: electrificationFillPaint([1]),
        layout: electrificationLayout,
      },
      {
        id: 'electrification_railway_line_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line',
        paint: electrificationFillPaint([1]),
        layout: electrificationLayout,
      },
      {
        id: 'electrification_future_proposed',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_future',
        filter: ['==', ['get', 'state'], 'proposed'],
        paint: electrificationFillPaint(electrification_proposed_dashes),
        layout: electrificationLayout,
      },
      {
        id: 'electrification_future_construction',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_future',
        filter: ['==', ['get', 'state'], 'construction'],
        paint: electrificationFillPaint(electrification_construction_dashes),
        layout: electrificationLayout,
      },
      {
        id: 'electrification_signals_direction',
        type: 'symbol',
        minzoom: 16,
        source: 'openrailwaymap',
        'source-layer': 'electrification_signals',
        filter: ['all',
          ['!=', ['get', 'azimuth'], null],
          ['!=', ['get', 'feature'], ''],
        ],
        layout: {
          'icon-overlap': 'always',
          'icon-image': 'general/signal-direction',
          'icon-offset': ['literal', [0, 15]],
          'icon-rotate': ['get', 'azimuth'],
        }
      },
      {
        id: 'electrification_signals',
        type: 'symbol',
        minzoom: 16,
        source: 'openrailwaymap',
        'source-layer': 'electrification_signals',
        paint: {
          // TODO https://github.com/maplibre/martin/issues/1075
          // 'icon-halo-color': 'rgba(255, 255, 255, 1)',
          // 'icon-halo-blur': 0,
          // 'icon-halo-width': 2.0,
        },
        layout: {
          'icon-overlap': 'always',
          'icon-image': ['image', ['get', 'feature']],
        }
      },
      {
        id: 'electrification_signals_unknown',
        type: 'circle',
        source: 'openrailwaymap',
        'source-layer': 'electrification_signals',
        filter: ['==', ['get', 'feature'], null],
        paint: {
          'circle-color': '#f00',
          'circle-blur': 1,
        },
      },
      {
        id: 'electrification_railway_text_med',
        type: 'symbol',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line_med',
        filter: ['all',
          ['==', ['get', 'railway'], 'rail'],
          ['any',
            ['==', ['get', 'usage'], 'main'],
            ['==', ['get', 'usage'], 'branch'],
          ],
          ['==', ['get', 'service'], null],
        ],
        paint: {
          'text-halo-color': 'white',
          'text-halo-width': 1.5,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': '{label}',
          // TODO not present: oblique font
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 30,
          'symbol-spacing': 100,
        },
      },
      {
        id: 'electrification_railway_text_high',
        type: 'symbol',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'electrification_railway_line',
        filter: ['step', ['zoom'],
          ['all',
            ['==', ['get', 'railway'], 'rail'],
            ['any',
              ['==', ['get', 'usage'], 'main'],
              ['==', ['get', 'usage'], 'branch'],
            ],
            ['==', ['get', 'service'], null],
          ],
          9,
          ['all',
            ['==', ['get', 'railway'], 'rail'],
            ['any',
              ['==', ['get', 'usage'], 'main'],
              ['==', ['get', 'usage'], 'branch'],
              ['==', ['get', 'usage'], 'industrial'],
            ],
            ['==', ['get', 'service'], null],
          ],
          10,
          ['any',
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
              ],
              ['==', ['get', 'service'], null],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], 'industrial'],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], null],
              ['any',
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'narrow_gauge'],
              ['any',
                ['==', ['get', 'service'], null],
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'construction'],
              ['==', ['get', 'feature'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
              ],
              ['==', ['get', 'service'], null],
            ],
          ],
          11,
          ['any',
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
              ],
              ['==', ['get', 'service'], null],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], 'industrial'],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], null],
              ['any',
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
                ['==', ['get', 'service'], 'yard'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'narrow_gauge'],
              ['any',
                ['==', ['get', 'service'], null],
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
                ['==', ['get', 'service'], 'yard'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'construction'],
              ['==', ['get', 'feature'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
                ['==', ['get', 'usage'], 'subway'],
                ['==', ['get', 'usage'], 'light_rail'],
              ],
              ['==', ['get', 'service'], null],
            ],
            ['all',
              ['any',
                ['==', ['get', 'railway'], 'subway'],
                ['==', ['get', 'railway'], 'light_rail'],
              ],
              ['==', ['get', 'service'], null],
            ],
          ],
          12,
          true,
        ],
        paint: {
          'text-halo-color': 'white',
          'text-halo-width': 1.5,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': '{label}',
          // TODO not present: oblique font
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 30,
          'symbol-spacing': 100,
        },
      },
    ],

    gauge: [
      backgroundColor,
      backgroundMap,
      {
        id: 'gauge_railway_line_low_casing',
        type: 'line',
        maxzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line_med',
        filter: ['==', ['get', 'usage'], 'main'],
        paint: gaugeCasingPaint,
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_line_med_casing',
        type: 'line',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line_med',
        paint: gaugeCasingPaint,
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_line_casing',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['!=', ['get', 'railway'], 'construction'],
        paint: gaugeCasingPaint,
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_line_casing_construction',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['==', ['get', 'railway'], 'construction'],
        paint: {
          'line-color': 'white',
          'line-width': railwayLineWidth,
          'line-gap-width': 0.75,
          'line-dasharray': gauge_construction_dashes,
        },
      },
      {
        id: 'gauge_railway_line_low_fill',
        type: 'line',
        maxzoom: 7,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line_med',
        filter: ['==', ['get', 'usage'], 'main'],
        paint: gaugeFillPaint('gauge0', 'gaugeint0', [1]),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_line_med_fill',
        type: 'line',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line_med',
        paint: gaugeFillPaint('gauge0', 'gaugeint0', [1]),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_line_fill',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['!=', ['get', 'railway'], 'construction'],
        paint: gaugeFillPaint('gauge0', 'gaugeint0', [1]),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_line_fill_construction',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['==', ['get', 'railway'], 'construction'],
        paint: gaugeFillPaint('gauge0', 'gaugeint0', gauge_construction_dashes),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_dual_gauge_line',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['all',
          ['!=', ['get', 'gauge1'], null],
          ['!=', ['get', 'railway'], 'construction'],
        ],
        paint: gaugeFillPaint('gauge1', 'gaugeint1', gauge_dual_gauge_dashes),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_dual_gauge_line_construction',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['all',
          ['!=', ['get', 'gauge1'], null],
          ['==', ['get', 'railway'], 'construction'],
        ],
        paint: gaugeFillPaint('gauge1', 'gaugeint1', dual_construction_dashes),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_multi_gauge_line',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['all',
          ['!=', ['get', 'gauge2'], null],
          ['!=', ['get', 'railway'], 'construction'],
        ],
        paint: gaugeFillPaint('gauge2', 'gaugeint2', gauge_multi_gauge_dashes),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_multi_gauge_line_construction',
        type: 'line',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['all',
          ['!=', ['get', 'gauge2'], null],
          ['==', ['get', 'railway'], 'construction'],
        ],
        paint: gaugeFillPaint('gauge2', 'gaugeint2', multi_construction_dashes),
        layout: gaugeLayout,
      },
      {
        id: 'gauge_railway_text_med',
        type: 'symbol',
        minzoom: 7,
        maxzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line_med',
        filter: ['all',
          ['==', ['get', 'railway'], 'rail'],
          ['any',
            ['==', ['get', 'usage'], 'main'],
            ['==', ['get', 'usage'], 'branch'],
          ],
          ['==', ['get', 'service'], null],
        ],
        paint: {
          'text-halo-color': 'white',
          'text-halo-width': 1.5,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': '{label}',
          // TODO under construction: oblique font
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 30,
          'symbol-spacing': 100,
        },
      },
      {
        id: 'gauge_railway_text_high',
        type: 'symbol',
        minzoom: 8,
        source: 'openrailwaymap',
        'source-layer': 'gauge_railway_line',
        filter: ['step', ['zoom'],
          ['all',
            ['==', ['get', 'railway'], 'rail'],
            ['any',
              ['==', ['get', 'usage'], 'main'],
              ['==', ['get', 'usage'], 'branch'],
            ],
            ['==', ['get', 'service'], null],
          ],
          9,
          ['all',
            ['==', ['get', 'railway'], 'rail'],
            ['any',
              ['==', ['get', 'usage'], 'main'],
              ['==', ['get', 'usage'], 'branch'],
              ['==', ['get', 'usage'], 'industrial'],
            ],
            ['==', ['get', 'service'], null],
          ],
          10,
          ['any',
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
              ],
              ['==', ['get', 'service'], null],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], 'industrial'],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], null],
              ['any',
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'narrow_gauge'],
              ['any',
                ['==', ['get', 'service'], null],
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'construction'],
              ['==', ['get', 'feature'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
              ],
              ['==', ['get', 'service'], null],
            ],
          ],
          11,
          ['any',
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
              ],
              ['==', ['get', 'service'], null],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], 'industrial'],
            ],
            ['all',
              ['==', ['get', 'railway'], 'rail'],
              ['==', ['get', 'usage'], null],
              ['any',
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
                ['==', ['get', 'service'], 'yard'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'narrow_gauge'],
              ['any',
                ['==', ['get', 'service'], null],
                ['==', ['get', 'service'], 'siding'],
                ['==', ['get', 'service'], 'crossover'],
                ['==', ['get', 'service'], 'spur'],
                ['==', ['get', 'service'], 'yard'],
              ],
            ],
            ['all',
              ['==', ['get', 'railway'], 'construction'],
              ['==', ['get', 'feature'], 'rail'],
              ['any',
                ['==', ['get', 'usage'], 'main'],
                ['==', ['get', 'usage'], 'branch'],
                ['==', ['get', 'usage'], 'subway'],
                ['==', ['get', 'usage'], 'light_rail'],
              ],
              ['==', ['get', 'service'], null],
            ],
            ['all',
              ['any',
                ['==', ['get', 'railway'], 'subway'],
                ['==', ['get', 'railway'], 'light_rail'],
              ],
              ['==', ['get', 'service'], null],
            ],
          ],
          12,
          true,
        ],
        paint: {
          'text-halo-color': 'white',
          'text-halo-width': 1.5,
        },
        layout: {
          'symbol-z-order': 'source',
          'symbol-placement': 'line',
          'text-field': '{label}',
          // TODO not present: oblique font
          'text-font': ['Noto Sans Bold'],
          'text-size': 11,
          'text-padding': 30,
          'symbol-spacing': 100,
        },
      },
    ],
  };

  const makeStyle = selectedStyle => ({
    center: [12.55, 51.14], // default
    zoom: 3.75, // default
    glyphs: `${location.origin}/font/{fontstack}/{range}`,
    metadata: {},
    name: 'OpenRailwayMap',
    sources: sources[selectedStyle],
    sprite: `${location.origin}/sprite/symbols`,
    version: 8,
    layers: layers[selectedStyle],
  });

  const map = new maplibregl.Map({
    container: 'map',
    style: makeStyle(selectedStyle),
    hash: 'view',
    maxZoom: 18,
    minPitch: 0,
    maxPitch: 0,
  });

  class StyleControl {
    constructor(options) {
      this.options = options
    }

    onAdd(map) {
      this._map = map;
      this._container = createDomElement('div', 'maplibregl-ctrl maplibregl-ctrl-group maplibregl-ctrl-style');
      const form = createDomElement('form', 'form form-inline', this._container);
      const span = createDomElement('span', '', form);
      span.innerHTML = 'Style:&nbsp;'

      Object.entries(knownStyles).forEach(([name, styleLabel]) => {
        const id = `style-${name}`
        const wrapper = createDomElement('div', 'form-check form-check-inline', form);
        const button = createDomElement('input', 'form-check-input', wrapper);
        button.id = id
        button.type = 'radio'
        button.name = 'style'
        button.value = name
        button.onclick = () => this.options.onStyleChange(name)
        button.checked = (this.options.initialSelection === name)
        const label = createDomElement('label', 'form-check-label', wrapper);
        label.htmlFor = id
        label.innerText = styleLabel
      });

      return this._container;
    }

    onRemove() {
      removeDomElement(this._container);
      this._map = undefined;
    }
  }

  map.addControl(new StyleControl({
    initialSelection: selectedStyle,
    onStyleChange: changedStyle => {
      map.setStyle(makeStyle(changedStyle));
      const updatedHash = putStyleInHash(window.location.hash, changedStyle);
      const location = window.location.href.replace(/(#.+)?$/, updatedHash);
      window.history.replaceState(window.history.state, null, location);
    }
  }));
  map.addControl(new maplibregl.NavigationControl({
    showCompass: false,
    visualizePitch: false,
  }));
  map.addControl(
    new maplibregl.GeolocateControl({
      positionOptions: {
        enableHighAccuracy: true
      },
      trackUserLocation: true,
      showAccuracyCircle: false,
      showUserLocation: true,
    })
  );
  map.addControl(new maplibregl.FullscreenControl());
  map.addControl(new maplibregl.ScaleControl({
    maxWidth: 150,
    unit: 'metric',
  }), 'bottom-right');
</script>
</body>

</html>
